{:message
 [{:role "system"
   :content "You are an expert {{language}} language teacher creating educational grammar content for {{level}} level students aged {{age-group}} for classroom presentations.
IMPORTANT: You must ONLY respond with valid JSON. Never include any text, explanations, markdown code blocks, or commentary before or after the JSON. Start your response with { and end with }."}

  {:role "user"
   :content "Request is:
{{request}}

Request Requirements:
- Request must define grammar topic
- Request must define number of slides
- Request must define whether examples should be included
  - If examples are requested but number is not specified, ask for clarification

Class Settings (provided by teacher's configuration):
- Language: {{language}}
- CEFR Level: {{level}}
- Student Age Range: {{age-group}}
All generated content must be in {{language}} and appropriate for {{level}} level students aged {{age-group}}.

Native language setting: {{native-language}}
If native-language is set to No, do not include a translation field in examples.
If native-language is set to a language, include a translation to that language for each example.

Optional Context Rule:
- If a vocabulary topic exists in the current conversation, focus grammar explanations and examples on that vocabulary topic where relevant

General Requirements:
- Explanations must be short, simple, and classroom-friendly
- Do NOT use linguistic jargon beyond the specified CEFR level
- Content must be culturally neutral and suitable for PowerPoint slides
- Grammar rules must be accurate and level-appropriate
- Examples must strictly follow the grammar rule and be realistic classroom sentences

STRICT Validation â€” do NOT skip this step, do NOT assume or infer missing information:
Check the request against each requirement listed above. If the teacher did NOT explicitly mention any of these, you MUST respond ONLY with:
{
  \"requirements-not-met\": \"your message asking the teacher to specify what is missing\"
}
Do NOT guess defaults. Do NOT generate content if any requirement is missing. Ask the teacher to clarify.

Current conversation:
{{messages}}

Content Rules:
- Each slide has a title and free-form text content
- Optionally include example sentences per slide
- Organize slides logically (e.g., rule overview, then forms, then usage, then examples)
- Adapt the number and organization of slides to what the teacher requested

Formatting Style:
The content will be displayed on presentation slides. Write for scannability, not paragraphs.
- Use short lines, not long sentences or paragraphs
- Use line breaks to visually separate sections and ideas
- Use symbols to create visual structure: headings (ðŸ“Œ), bullet points (ðŸ”¹), positive (âœ“), negative (âœ—), questions (?), arrows (â†’) for relationships or transformations
- Group related items together with clear spacing between groups
- Keep each line to one idea or one form pattern
- Make the content easy to read at a glance from the back of a classroom

Response Format:
Return a JSON object with this structure:

{
  \"title\": \"grammar topic title\",
  \"subtitle\": \"Level: {{level}} | number of slides\",
  \"slides\": [
    {
      \"slide-title\": \"slide title\",
      \"content\": \"Free-form text explaining this part of the grammar. Write naturally. Use line breaks to separate ideas.\",
      \"examples\": [
        {
          \"sentence\": \"Example sentence in {{language}}\",
          \"translation\": \"Translation to native language if set, omit this field if native-language is No\"
        }
      ]
    }
  ]
}

Example for a 3-slide grammar explanation:

{
  \"title\": \"Past Simple vs Present Perfect\",
  \"subtitle\": \"Level: B1 | 3 slides\",
  \"slides\": [
    {
      \"slide-title\": \"Overview\",
      \"content\": \"ðŸ“Œ Past Simple\\nUsed for completed actions at a specific time in the past.\\n\\nðŸ“Œ Present Perfect\\nUsed for actions that connect the past to the present.\",
      \"examples\": []
    },
    {
      \"slide-title\": \"How to Form\",
      \"content\": \"ðŸ“Œ Past Simple\\n  âœ“ I visited\\n  âœ— I did not visit\\n  ? Did you visit?\\n\\nðŸ“Œ Present Perfect\\n  âœ“ I have visited\\n  âœ— I have not visited\\n  ? Have you visited?\",
      \"examples\": []
    },
    {
      \"slide-title\": \"Usage and Examples\",
      \"content\": \"ðŸ”¹ Use Past Simple when you mention a specific time\\n   â†’ yesterday, last week, in 2020\\n\\nðŸ”¹ Use Present Perfect when the time is not important\\n   â†’ ever, never, already, yet\",
      \"examples\": [
        {\"sentence\": \"I visited Paris last year.\", \"translation\": \"Completed action at a specific time.\"},
        {\"sentence\": \"I have visited Paris three times.\", \"translation\": \"Experience up to now, time not specified.\"}
      ]
    }
  ]
}

Ensure the output is valid JSON and ready for direct use in presentation generation."}]
 :config {:model "gpt-4"
          :temperature 0.7
          :max-tokens 2000}}
